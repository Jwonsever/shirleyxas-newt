<!DOCTYPE html>
<html>
  <head>
    <title>ALS Data and Simulation Portal</title>
    <!-- Bootstrap -->
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <link href="../als_portal.css" rel="stylesheet" type="text/css" />
    <!-- <link rel="stylesheet" href="ShirleyXAS.css"> -->

    <script src="../jquery-latest.js"></script>    
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="../mynewt.js"></script>
    <script src="../alsapi.js"></script>
    <script src="../als_portal.js"></script>

    <script src="GlobalValues.js"></script>
    <script src="javascript/jmol-13-0/Jmol.js"></script>
    <script src="javascript/jmol-13-0/JmolCore.js"></script>
    <script src="javascript/jmol-13-0/JmolApplet.js"></script>
    <script src="javascript/jmol-13-0/JmolControls.js"></script>
    <script src="javascript/jmol-13-0/JmolApi.js"></script>
    <script src="javascript/jmol-13-0/JmolJME.js"></script>
    <script src="javascript/Flot/jquery.flot.js"></script>
    <script src="javascript/Flot/jquery.flot.navigate.js"></script>
    <script src="ajaxfileupload.js"></script>
    <script src="ShirleyXAS.js"></script>
    <script src="jmolScripts.js"></script>

    <!--Applet, Initialization, And Options-->
    <script>
      var mainApplet = "mainApplet";
      var previewApplet = "previewApplet";
      var resultsApplet = "resultsApplet";

      var JmolInfo = {
      width: 400,
      height: 400,
      debug: false,
      color: "black",
      addSelectionOptions: false,
      serverURL: "http://portal.nersc.gov/project/als/jack-area/WebXS",
      jarPath: "javascript/jmol-13-0",
      jarFile: "JmolAppletSigned.jar",
      isSigned: true,
      script: ""
      };
      
      var mainJme = "mainJme";
      var JMEInfo = {
      jarPath: "javascript/",
      jarFile: "JME.jar"
      };
      
      Jmol.setGrabberOptions(
      [["$", "NCI(small molecules)"],
      [":", "PubChem(small molecules)"],
      ["=", "RCSB(macromolecules)"]]);

    </script>

  </head>
  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><img src="../alslogo.png" width=56 padding=0 border=0></li>
              <li><a href="../index.html">Home</a></li>
              <li><a href="../about.html">About</a></li>
              <li><a href="../status.html">Status</a></li>
              <li><a href="../data.html">Data Browser</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Simulation Tools <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="nav-header">X-Ray Scattering</li>
                  <li><a href="#">GISAXS Code 1</a></li>
                  <li><a href="#">GISAXS Code 2</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">X-Ray Absorption</li>
                  <li class="active"><a href="#">Shirley XAS</a></li>
                  <li><a href="#">FEFF</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Photoemission</li>
                  <li><a href="#">BerkeleyGW</a></li>
                </ul>
              </li>
            </ul>
            <div class="pull-right" id="auth-spinner"> <img src="../white-ajax-loader.gif"></div>
            <div id=login-area style='display:none;' class="pull-right">
              <form class="navbar-form pull-right" method=POST action='javascript: submission();'>
                <input class="span2" type="text" placeholder="Username" id="id_username">
                <input class="span2" type="password" placeholder="Password" id="id_password"> </button>
                <button type="submit" class="btn">Sign in</button>
              </form>
            </div>
            <div id=logout-area class="pull-right" style='display:none;'>
              <form class="navbar-form pull-right" method=POST action='javascript: logout();'>
                <button type="submit" class="btn">Logout</button>
              </form>
              <div id=username-area class="pull-right" style="padding:10px"></div>
            </div>
          </div><!--/.nav-collapse -->
        </div>
      </div>
	    </div>

    <div class="container">
      <!--
      <div class="hero-unit">
        <h2>Welcome to the ALS Data and Simulation Portal</h2>
        <p>This site is a very large work in progress. Log in with your NERSC account at the top right to gain access to NERSC compute resources
           (required for simulation and analysis tools).</p>
        <p><a class="btn btn-primary btn-large" href="about.html">Learn more. &raquo;</a></p>
      </div>
      -->

      <div class="row">

        <div class="span2">
          <div class="tabbable"> <!-- Only required for left/right tabs -->
            <ul class="nav nav-pills nav-stacked">
              <li class="active"><a href="#shirleyinfo" data-toggle="tab">What is this?</a></li>
              <li><a href="#searchDB" data-toggle="tab" onclick="switchToSearchDB()">Search Database</a></li>
              <li><a href="#runningjobs" data-toggle="tab" onclick="switchToRunning()">Running Calculations</a></li>
              <li><a href="#previousjobs" data-toggle="tab" onclick="switchToPrevious()">Finished Calculations</a></li>
              <li><a href="#submitjobs" data-toggle="tab" onclick="switchToSubmitForm()">Submit Calculations</a></li>
              <li><a href="#moleculeEditor" data-toggle="tab" onclick="switchToDrawMolecule()">Draw Molecule</a></li>
            </ul>
          </div>
        </div>

        <!--
        <div id='menu'>
	  <br><br>
	  <a href="javascript: switchToInfo();">What is this?</a><br><br>
	  <a href="javascript: switchToSearchDB();">Search Database</a><br><br>
	  <a href="javascript: switchToRunning();">Running Calculations</a><br><br>
	  <a href="javascript: switchToPrevious(); ">Finished Calculations</a><br><br>
	  <a href="javascript: switchToSubmitForm();">Submit Calculations</a><br><br>
	  <a href="javascript: switchToDrawMolecule();">Draw Molecule</a><br><br>
	</div>
        -->

        <div class="span10" style='min-height:500px;background-color: #eeeeee; border-radius:5px;'>
          <div style='padding:20px'>
            <div class="tab-content">

	      <div id='runningjobs' class="tab-pane"></div>
	      <div id='previousjobs' class="tab-pane"></div>

	      <div id='searchDB' class="tab-pane">
	  	<h2 align="left">MFTheory Core Excitation Database</h2>
                <p align="left">
		  If you cannot find what you are looking for, try these:<br>
		  <a href="http://unicorn.mcmaster.ca/corex/Search-List.html">Mcmasters Gas phase Core Excitation experimental database.</a><br>
                  <a href="http://foundry.lbl.gov/">Molecular Foundry collected experimental database.</a><br><br>
		  --WebXS predicted Spectra<br>
		  <input type="Text" id="searchTerms" value=""/>
		  <button onclick="searchDB()">Search</button>
                </p>
		<div id="searchResults"></div>
	      </div>
	      
 	      <!--What is ShirleyXAS and what does it do?-->
	      <div id='shirleyinfo' class="tab-pane active">
	  	    <img src="images/WebXS.png" style="padding:20px" align="left" height="200" width="200"/> <br>
		    <p align="left">To facilitate the simulation of near-edge x-ray absorption fine structure (NEXAFS) spectra using established 
methods based on constrained density functional theory (DFT), we have developed a web-based interface which enables the user to launch such 
simulations on high-performance computing resources at the National Energy Research Scientific Computing Center (NERSC). Using the NERSC web toolkit 
(NEWT), we have written a web-interface to run highly parallelized DFT calculations based on this Web2.0 API. The interface enables the user to 
upload/build their molecule/crystal of choice, visualize it, generate its NEXAFS spectrum and interpret spectral features based on visualization of 
electronic excited states.<br><br>This tool is not meant to work with IE.  Please use a different browser, such as Firefox or Google chrome.<br><br> 
Currently computing K-edge spectra for Li, B, C, N, O, F, Cd, S, and Ti.  More coming soon. <br><br> Please send questions and comments regarding the 
website to jrdeslippe@lbl.gov.
  	  	    <!--Needs work-->
		    <button valign="middle" onclick="window.open( 'http://portal.nersc.gov/project/als/jack-area/WebXS/faq.html');">FAQ and Tutorial</button></p>
		    <p><center>
		    <img src="images/MFLogo.png" width="300px" height="100px"/>
		    <img src="images/NERSCLogo.png" width="200px" height="100px"/>
		    <img src="images/jmolLogo.png" width="200px" height="100px"/>
		    </center><p>
	      </div>
	      <!-- End -->

	      <!--All Functions for editing and manipulating molecules-->
	      <div id='moleculeEditor' class="tab-pane">
		    <h3>Jmol Molecular Viewer</h3><br>

		    <a href="javascript:Jmol.showInfo(mainApplet, true)">2D</a>
		    <a href="javascript:Jmol.showInfo(mainApplet, false)">3D</a>
		    <script>
		      JmolInfo.width = 600;
		      mainApplet =Jmol.getApplet(mainApplet, JmolInfo);
		      mainJme = Jmol.getJMEApplet(mainJme, JMEInfo, mainApplet);
		      setTimeout("initMainApp();", 200);
		    </script>
		    <br> 
		    <a href="#" onclick="window.open('http://chemapps.stolaf.edu/jmol/docs?ver=13.0');")>Command Line Instructions</a><br>
		    <script>
		      Jmol.jmolCommandInput(mainApplet);
		    </script>

		    <form id='loadfile'>
		      <input type=file id="uploadfile" name="uploadfile" onchange="uploadToEditor(this.form)"/><br></form>	      
		    <button onClick="minimizeStructure()">Minimize Structure</button>
		    <button onClick="toggleModelkitMode()">Edit Structure</button>
		    <button onClick="portCoordinates()">Port Coordinates</button><br>
	      </div> 
	      <!-- End -->

	      <!-- Submitting a job form. -->
	      <div id='submitjobs' align=left class="tab-pane">
		    <h3>Submit Calculation</h3>
                    <table valign=top><tr><td valign=top>
		    <form id='inputs' name='inputs' METHOD="GET">
		      Material Name<br>
		      <input type='text' name='MOLNAME' id='material' value="MolName"/><br>
		      Excited Atoms<br>
		      <input type="text" name="XASELEMENTS" id="XASELEMENTS" value="C" onkeyup="addSelections();"/><br>
		      <!-- </td></tr></tr><td> -->
		      Coordinates<br><div id = "Coordinates"></div>
		      <script>makeCoordsDiv()</script><br>
		      Upload Coordinates<br>
		      <input type=file id='uploadfile' name='uploadfile' onchange="uploadCoordinates()">
		      <!-- Adds a new coordinates, upload loads to the current coordinates. -->
		      <br>
		      <div id="advancedOptions" style="display:none;"><br>
		        <b>Advanced Options</b><br><br>
		      <!--Advanced Options-->
		      <input type="Checkbox" onchange="makeCellSize()" id="CrystalFlag" value="True"/> Crystal?
		      <br>
		      <input type="Text" id="IBRAV" size="4" value="14"/> Bravais Lattice<br>
		      <br>Cell Size Attributes:<br>
		      <input type="text" size="10" onchange="drawMolInPreview()" id="CellA" value="10"/> A
		      <input type="text" size="10" onchange="drawMolInPreview()" id="CellB" value="10"/> B
		      <input type="text" size="10" onchange="drawMolInPreview()" id="CellC" value="10"/> C
		      <input type="text" size="10" onchange="drawMolInPreview()" id="CellAlpha" value="90"/> &alpha;
		      <input type="text" size="10" onchange="drawMolInPreview()" id="CellBeta" value="90"/> &beta;
		      <input type="text" size="10" onchange="drawMolInPreview()" id="CellGamma" value="90"/> &gamma;
		      <br><br>
                      <table cellpadding=8><tr><td>
		      Output Directory:</td><td> <input type="Text" size="25" id="outputDir" value="/global/scratch/sd/invalid"/>
                      </td></tr><tr><td>Cluster:</td><td>
		      <select name="Select Cluster" id="machine" onchange="form.PPP.value=24; updateStatus(this.value);" value="hopper">
		        <option value="hopper">Hopper</option>
                      </select> <br><span id='clusterStatus' style='display:none;'></span></td></tr>
		  
		      <tr><td>Nodes Per Atom:</td><td>
		      <input type="Text" id="NPERATOM" value="1"/></td></tr>
		      <tr><td>BND_FAC:</td><td>
		      <input type="Text" id="NBANDFAC" value="8"/></td></tr>
		      <tr><td>Total Charge:</td><td>
		      <input type="Text" id="TOTCHG" value="0"/></td></tr>

		      <tr><td>Queue:</td><td>
		      <select name="Select Queue" id="Queue" value="regular"
			  onChange="if(this.value=='debug') $('#wallTime').val('00:30:00'); else $('#wallTime').val('01:30:00');">
		        <option value="regular">Regular</option>
		        <option value="debug">Debug</option>
		        <option value="low">Low priority</option>
		        <option value="premium">Premium*</option>
		        <option value="scavenger">Scavenger**</option>
                      </select>
		      &nbsp;&nbsp;<a href="#" onclick="window.open('http://www.nersc.gov/users/computational-systems/hopper/running-jobs/queues-and-policies/');")>About</a>
                      </td></tr>		  

		      <tr><td>Walltime:</td><td><input type="Text" id="wallTime" value="01:30:00"/>
		      </td></tr>
                      </table>

		      <!-- Hidden From User -->
		      <input type="hidden" id="NNODES" value="1"/>
		      <input type="hidden" id="PPP" value="24"/> 

		      <input id="lessAdvanced" data-inline='true' type='button' value='Hide Advanced Options' onClick="hideAdvancedOptions()"/>
		      <!-- End Advanced Options -->
		      </div>
		      <input id="AdvancedButton" data-inline='true' type='button' value='Advanced Options' onClick="showAdvancedOptions()"/>

		      <input id="Submit" data-inline='true' type='button' value='Submit' onClick="validateInputs(this.form)"/>
		      <div id="subStatus"></div>
		    </form>
		    </td><td width=40></td><td valign=top>
		      <!--Molecule Preview -->
		      Preview<br>
		      <div style="background-color:black;color:#AA2222;">
		        <span id="previewLoadingText" style="float:left;">Please Wait for Jmol to load....</span>
		        <script>
		          JmolInfo.width = 400;
		          JmolInfo.height = 400;
		          previewApplet = Jmol.getApplet(previewApplet, JmolInfo);
		          setTimeout("initPreviewApp();", 400);
		        </script>
		      </div><br>
		      <input type='button' value='Animate' onClick="animatePreview()">
		      <input type='button' value='Supercell' onClick="supercellPreview()"/>
		      </td></tr></table>
	       </div>
	    </div>
          </div>
        </div>
      </div>

      <hr>

      <footer>
        <p>&copy; LBL LDRD 2013</p>
      </footer>

    </div> <!-- /container -->

    <script>
      myCheckAuth();
      makeCoordsDiv();
      getXCHShift();
    </script>

  </body>
</html>

